{{#*inline "page"}}
    <ajax-form>
        <article>
            <header class=article-header>{{{posts.0.title_html}}}</header>
            {{#if posts.0.excerpt_html}}
                <main>{{{posts.0.excerpt_html}}}</main>
            {{/if}}
            <footer>
            submitted by <a href="@{{posts.0.submitted_by_username}}">{{posts.0.submitted_by_username}}</a>
            {{date posts.0.created_at}}
            {{#if starred_by}}
                starred by
                {{#each starred_by}}
                    <a href="@{{this}}">{{this}}</a>
                    {{#unless @last}},{{/unless}}
                {{/each}}
            {{/if}}
            <form class=module-aside action="vote?redirect={{posts.0.uuid}}" method=POST>
                {{#if (gte user.trust_level 3)}}
                    <a href="edit-post?post={{posts.0.uuid}}" class=button>Edit</a>
                {{/if}}
                <button name="{{#if posts.0.starred_by_me}}rm_star{{else}}add_star{{/if}}" value={{posts.0.uuid}} title="{{#if posts.0.starred_by_me}}Remove star{{else}}Add star{{/if}}">
                    <span>{{posts.0.score}}</span>
                    <img width=12 height=12 class=good-img src=assets/{{#if posts.0.starred_by_me}}star_active.svg{{else}}star.svg{{/if}} alt="{{#if posts.0.starred_by_me}}Remove star{{else}}Add star{{/if}}">
                </button>
                <!-- flagging is not yet implemented -->
                <button name=post value={{posts.0.uuid}} title="Add flag">
                    <img width=12 height=12 class=good-img src=assets/flag.svg alt="Add flag">
                </button>
            </form>
            </footer>
        </article>
        {{#each comments}}
            <aside>
                <main>{{{this.html}}}</main>
                <footer>
                    posted by <a href="@{{this.created_by_username}}">{{this.created_by_username}}</a>
                    {{date this.created_at}}
                    {{#if this.starred_by}}
                        starred by
                        {{#each this.starred_by}}
                            <a href="@{{this}}">{{this}}</a>
                            {{#unless @last}},{{/unless}}
                        {{/each}}
                    {{/if}}
                    <form class=module-aside action="vote-comment?redirect={{posts.0.uuid}}" method=POST>
                    {{#if (or (gte ../user.trust_level 3) (eq this.created_by ../user.id))}}
                        <a href="edit-comment?comment={{this.id}}" class=button>Edit</a>
                    {{/if}}
                    <button name="{{#if this.starred_by_me}}rm_star_comment{{else}}add_star_comment{{/if}}" value={{this.id}} title="{{#if this.starred_by_me}}Remove star{{else}}Add star{{/if}}">
                        <span>{{count this.starred_by}}</span>
                        <img width=12 height=12 class=good-img src=assets/{{#if this.starred_by_me}}star_active.svg{{else}}star.svg{{/if}} alt="{{#if this.starred_by_me}}Remove star{{else}}Add star{{/if}}">
                    </button>
                    <!-- flagging is not yet implemented -->
                    <button name=add_flag_comment value={{this.id}} title="Add flag">
                        <img width=12 height=12 class=good-img src=assets/flag.svg alt="Add flag">
                    </button>
                    </form>
                </footer>
            </aside>
        {{/each}}
    </ajax-form>
    <form action="comment" method=POST>
        <h3>Post your comment</h3>
        <textarea name=text></textarea>
        <input type=hidden name=post value="{{posts.0.uuid}}">
        <button>Submit</button>
    </form>
{{/inline}}
{{~> (parent)~}}
